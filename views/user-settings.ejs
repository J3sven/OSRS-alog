<html>

<!-- Most of the structure, images and styles on this page are retrieved from an old cache of the official Runescape website. This is not my work, I just it used as scaffolding to recreate the page. The visual design is not my work, but the functionality is. I have included the images and styles in the repo as they are no longer available on the official website. The visual assets that are retrieved from the cache are separated in the alog_assets directory. -->

<head>
  <link rel="SHORTCUT ICON" href="alog_assets/favicon.ico">
  <title>Adventurer's log</title>
  <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <%- include('modules/menubar') %>
    <%- include('modules/video') %>
    <div class="container">
      <section id="content">
        <div class="basicpanel"> 
            <h1>User Settings</h1>
            <div class="tab">
                <button class="tablinks" onclick="openTab(event, 'Overview')">Account</button>
                <button class="tablinks" onclick="openTab(event, 'Webhooks')">Webhook</button>
                <button class="tablinks" onclick="openTab(event, 'Characters')">Your Characters</button>
              </div>
              <div id="Overview" class="tabcontent">
                <h2>Account</h2>
                <p>Logged in as:</p>
                <div id="userPanel">
                    <div class="avatar" style="position: relative; width: 42px; height: 42px;">
                        <img width="35" height="35" style="border-radius: 100%;" src="https://cdn.discordapp.com/avatars/<%= userData.id %>/<%= userData.avatar %>.png">
                        <img width="42" height="42" style="position: absolute; left: 3px; top: -5px;" src="https://cdn.discordapp.com/avatar-decoration-presets/<%= userData.avatar_decoration_data.asset %>.png">
                    </div>
                    <p><%= userData.global_name %></p>
                </div>
                <button id="logoutButton" class="button">Logout</button>
              </div>
              <div id="Webhooks" class="tabcontent">
                <h2>Your Webhook</h2>
                <ul>
                  <% userwebhooks.forEach((webhook) => { %>
                    <li><%= webhook %></li>
                  <% }) %>
                </ul>
              </div>
              
              <div id="Characters" class="tabcontent">
                <h2>Your Characters</h2>
                <ul>
                  <% characters.forEach((character) => { %>
                    <li><%= character %></li>
                  <% }) %>
                </ul>
              </div>
        </div>
      </section>
      <%- include('modules/footer') %>
    </div>

    <script>
        logoutButton.addEventListener('click', async () => {
            const res = await fetch('http://localhost:3000/api/logout', { method: 'POST' })
            const data = await res.json()
            if (data.loggedOut) {
                // Clear the user info on the front-end and re-fetch user info
                fetchUserInfo()
                window.location.href = '/'
            }
        })

        function openTab(evt, tabName) {
          var i, tabcontent, tablinks;
          tabcontent = document.getElementsByClassName("tabcontent");
          for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
          }
          tablinks = document.getElementsByClassName("tablinks");
          for (i = 0; i < tablinks.length; i++) {
            tablinks[i].className = tablinks[i].className.replace(" active", "");
          }
          document.getElementById(tabName).style.display = "block";
          evt.currentTarget.className += " active";
        }
    
        // Get the element with id="defaultOpen" and click on it
        document.addEventListener("DOMContentLoaded", (event) => {
          document.querySelector(".tablinks").click();
        });
      </script>
        <style>
            .tab {
              overflow: hidden;
              border-top-left-radius: 4px;
              border-top-right-radius: 4px; 
            }
        
            .tab button {
              background-color: inherit;
              float: left;
              border: none;
              outline: none;
              cursor: pointer;
              padding: 8px 16px;
              transition: 0.3s;
              font-size: 14px;
              border-top-left-radius: 4px;
              border-top-right-radius: 4px; 
              color: white;
              background-color: #242424;
            }
        
            .tab button:hover {
              background-color: #5c5858;
            }
        
            .tab button.active {
              background-color: #3B3D40;
            }
        
            .tabcontent {
              display: none;
              padding: 6px 12px;
              border: 1px solid #3B3D40;
              text-align: left;
            }
          </style>
  </body>
  